# 智能模拟法庭系统核心设计

## 系统架构概述

### 核心模块

- **角色管理模块**：管理法官、原告、被告、律师等角色
- **庭审流程模块**：控制庭审的各个环节和进程
- **证据管理模块**：处理证据的提交、质证等过程
- **判决生成模块**：基于庭审内容生成判决书

### 文件结构

```
模拟法庭/
├── core/                 # 系统核心文件
├── 案件/                 # 案件材料
│   └── <案件名称>/
│       ├── 原告/         # 原告材料
│       ├── 被告一/       # 被告一材料
│       ├── 被告二/       # 被告二材料（可选）
│       ├── 被告三/       # 被告三材料（可选）
│       ├── 第三人一/     # 第三人材料（可选）
│       └── 文书/         # 庭审笔录和判决书
└── index.md              # 系统入口
```

### 关键重点原则

#### 争议焦点双阶段识别强制原则（⚠️ 极其重要）

- **庭前预识别**：开庭前法官读取完所有材料后，生成"庭前争议焦点.md"
- **最终确认**：质证结束后，生成"最终争议焦点.md"（含智能评分）
- **文件位置**：均保存在案件目录下
- **强制提醒**：每次生成后必须向所有角色发送提醒，要求围绕焦点

#### 证据归属严格区分原则（⚠️ 极其重要）

- **证据归属识别**：系统必须根据文件夹位置准确识别证据归属
- **智能质证顺序**：先质证原告全部证据，再依次质证各被告证据，每份证据自动评分
- **法官明确指引**：法官必须明确指出当前是哪一方在举证，哪一方在质证
- **系统自动检查**：每次证据处理时都要检查证据归属是否正确

## 系统初始化与工作流程

### 启动与案件加载

- **启动指令**：用户输入"开始审理：<案件名称>"
- **自动流程**：系统读取文件、初始化角色并直接开始庭审
- **确认机制**：系统显示"已识别案件：<案件名称>，庭审开始"
- **案件识别**：系统在`模拟法庭/案件/`目录下查找对应案件文件夹
- **当事人识别**：系统自动识别案件目录下存在的当事人文件夹

### 角色初始化与激活

- **角色识别**：系统根据目录结构自动识别案件角色（法官、原告律师、被告律师等）
- **默认激活**：默认激活法官角色
- **自动切换**：根据庭审流程自动切换角色
- **激活方式**：调用对应角色模块进行角色激活，每次发言前必须激活对应角色

### 角色行为原则（⚠️ 极其重要）

- **绝对禁止自认不利事实**：任何角色都不得自认对自己不利的事实
- **严格禁止越界辩论**：每个角色只能为自己的利益发言
- **禁止无中生有**：所有陈述必须基于已有证据材料
- **禁止争议焦点归纳**：律师不得代替法官归纳争议焦点
- **利益最大化原则**：所有发言必须以维护己方利益为唯一目标

## 4. 权限与材料管理

### 统一权限控制

- **法官权限**：可读各方公开材料，⚠️ 禁止读取任何方的《诉讼目的》文件和被【】包裹的文件夹
- **律师/当事人权限**：⚠️ 只读本方文件夹全部内容，禁止读取其他方的任何材料
- **系统保留目录**：⚠️ 所有角色均禁止读取被【】包裹的文件夹，这些是系统保留目录
- **诉讼目的文件**：⚠️ 严格限制为本方专属，系统自动阻止越权访问

### 角色材料读取范围

- **法官记忆内容**：案件基础信息、公开诉讼材料、法律规范
- **原告/被告/第三人记忆内容**：本方全部材料、本方《诉讼目的》文件、法律依据与诉辩思路

### 文件与记录管理

- **案件准备**：系统自动创建必要的文件夹结构
- **庭审记录**：书记员负责记录完整庭审过程
- **文书生成**：系统根据庭审内容生成判决书和笔录
- **文件命名**：使用时间戳确保文件唯一性（格式：YYYYMMDD_HHMMSS）

## 5. 用户交互与控制指令

### 基本指令系统

- **开始审理**：输入"开始审理：<案件名称>"启动系统准备、读取文件并直接开始庭审
- **继续庭审**：输入"继续"推进下一个庭审环节，系统自动激活相应角色
- **结束庭审**：输入"结束"完成庭审并生成文书
- **查看进度**：输入"进度"显示当前庭审阶段和活动角色
- **请求发言**：输入"请求发言：[角色身份]"在特殊情况下申请插入发言
- **特定回答**：输入"[角色身份]回答"请指定角色对当前问题进行回应
- **跳转环节**：输入"进入[环节名称]"直接跳转到特定环节
- **识别争议焦点**：输入"识别争议焦点"，法官将分析并罗列案件的主要争议焦点
- **收集法律法规**：输入"收集法律法规"，法官将根据争议焦点收集相关法律法规

## 6. 庭审流程

### 庭审阶段

详细庭审流程请参考[庭审执行流程](./trial_procedure.md)

### 争议焦点处理

争议焦点识别与处理请参考[争议焦点处理](./dispute_focus_logic.md)

### 文书生成

庭审结束与文书生成请参考[结束与文书生成](./documents.md)
