# 角色隔离与独立性保障机制

## 核心原则（奥卡姆剃刀）

**最简隔离逻辑**：一个标识符 + 一个状态空间

## 角色标识符系统

### 唯一标识符生成

```
角色标识符 = role_type + "_" + client_id
```

例如：

- 原告律师：`lawyer_plaintiff`
- 被告一律师：`lawyer_defendant1`
- 被告二律师：`lawyer_defendant2`
- 法官：`judge_court`

### 标识符验证机制

1. **切换验证**：切换时验证角色标识符匹配
2. **冲突检测**：防止多个实例使用同一标识符

## 状态空间隔离

### 独立状态空间设计

每个角色维护独立状态空间：

1. **身份信息**：角色类型、委托人身份、职责
2. **记忆内容**：已读材料、立场观点、历史发言
3. **行为模式**：辩护策略、质证方法、论证风格

### 状态持久化机制

1. **状态保存**：发言后自动保存状态
2. **状态恢复**：切换时加载对应状态

## 角色切换流程

```
需要切换角色
↓
保存当前状态
↓
执行角色激活：promptx_action("target_role")
↓
绑定委托人身份（律师角色）
↓
加载目标角色状态
↓
验证切换成功
↓
开始发言
```

## 切换失败处理

```
检测到切换失败
↓
自动重试一次
↓
仍然失败时执行promptx_init刷新角色
↓
重新绑定身份并加载状态
```

## 角色冲突防护

1. **越界检测**：监控非授权访问和立场偏离
2. **立场一致性**：确保发言符合委托人利益
3. **自动纠正**：发现冲突立即中断并重新发言

---

**设计理念**：用最简单的标识和状态空间确保最可靠的角色独立性。
