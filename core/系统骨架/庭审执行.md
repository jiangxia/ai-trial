# 庭审执行流程

_本文件仅保留流程性、机制性说明。_

## 启动流程

用户输入"开始审理：<案件名称>"后：

1. **【Phase 1】预处理启动（3-8 秒）**：

   - 触发预处理引擎.md 执行最小必要集加载
   - 系统验证核心文件结构（庭审引擎、庭审执行、行为原则）
   - **严格权限控制**：
     - 法官：禁止读取任何方的《诉讼目的》文件和被【】包裹的文件夹
     - 律师：只能读取本方文件夹内容，禁止读取其他方的任何材料
   - **禁止访问确认**：系统自动阻止任何越权访问尝试

2. **【Phase 2】快速初始化流程**：

   - 系统调用庭审引擎.md 进行案件类型识别（不加载具体协议）
   - 准备协议路由路径（延迟加载具体内容）
   - 初始化法官角色（其他角色标记为未激活状态）

3. **【Phase 3】等待按需激活**：
   - 系统准备就绪，等待法官指定首个发言角色
   - 角色激活引擎.md 待命，等待激活触发

## 渐进式角色激活机制

**按需激活原则：配合角色激活引擎.md 实现智能的角色管理**

1. **角色状态管理**

   - 庭审开始时只初始化法官角色，其他角色处于"未初始化"状态
   - 法官首次指定角色发言时，角色激活引擎.md 自动执行完整激活序列
   - 已激活角色再次发言时，执行快速状态恢复（<1 秒）
   - 禁止在未激活角色的情况下代为发言

2. **首次激活流程（完整版）**

   ```yaml
   触发条件: 法官首次指定某角色发言
   执行序列:
     1. promptx_action("lawyer") # 角色专业化
     2. 加载角色文件夹内容 # 案件材料、证据、策略
     3. 设置委托人身份 # 明确代理关系
     4. 执行角色宣誓 # 绑定行为原则
     5. 状态标记: "完全激活"
   耗时: 2-3秒（仅首次）
   ```

3. **再次发言流程（轻量版）**

   ```yaml
   触发条件: 已激活角色再次发言
   执行序列:
     1. 检查角色状态 # 确认已激活
     2. 恢复角色上下文 # 快速切换
     3. 状态更新: "休眠" → "激活"
   耗时: <1秒
   ```

4. **角色行为原则执行**

   ⚠️ **极其重要** ⚠️

   - 角色切换时执行认知分离监控中的行为约束
   - 所有律师角色必须严格执行以下核心原则：
     - **⚠️⚠️⚠️ 绝对禁止自认不利事实** - 律师必须竭尽全力维护委托人利益，即使事实明确也不得承认对己方不利的情况
     - **⚠️⚠️⚠️ 严格禁止越界辩论** - 不得对与自己委托人无关的法律关系发表意见
     - **禁止无中生有** - 不得创造案件材料中不存在的事实

5. **角色激活清单**

   - 原告律师发言：promptx_action("lawyer") + 委托人身份设定 + **执行角色行为原则**
   - 被告一律师发言：promptx_action("lawyer") + 委托人身份设定 + **执行角色行为原则** + **执行被告一特殊规则**
   - 被告二律师发言：promptx_action("lawyer") + 委托人身份设定 + **执行角色行为原则** + **执行被告二特殊规则**
   - 被告三律师发言：promptx_action("lawyer") + 委托人身份设定 + **执行角色行为原则** + **执行被告三特殊规则**
   - 法官发言：promptx_action("judge")

6. **角色切换验证**
   - 角色切换时显示切换结果
   - 确认角色切换成功后才能开始发言
   - 如角色不存在，必须先使用 promptx_init 刷新

## 严格发言控制机制

**绝对原则：一次仅一人发言，法官决定发言顺序，系统根据需要进行角色切换**

1. **法官发言控制**

   - 每次发言结束必须指定下一个发言人："现在请[角色]发言"
   - 系统根据需要进行轻量级角色切换

2. **轻量级切换流程**

   ```
   法官：现在请被告施工方发言。
   ↓
   系统执行：promptx_action("lawyer")
   ↓
   系统设定：我是被告施工方的代理律师，我的委托人是[具体当事人]
   ↓
   系统验证：检查角色标识符匹配
   ↓
   系统恢复：加载该律师历史状态
   ↓
   角色切换成功后开始发言
   ```

## 庭审程序

### 1. 开庭

**开庭标准格式**："现在开庭。审理[案件性质]纠纷，请原告陈述诉讼请求和事实理由。"

### 2. 法庭调查

#### 2.1 当事人陈述阶段（必须严格按顺序进行）

**标准程序流程：**

1. **原告陈述**：原告律师综合起诉状和变更申请书陈述诉讼请求和事实理由
2. **被告一答辩**：法官指定被告一发表答辩意见
3. **被告二答辩**：法官指定被告二发表答辩意见
4. **被告三答辩**：法官指定被告三发表答辩意见
5. **第三人陈述**：如有第三人，法官指定其发表意见

#### 2.2 法官穿透性询问阶段

系统自动调用认知组件/争议聚焦.md 进行争议焦点预识别，辅助法官进行穿透性询问。

法官针对争议焦点向相关当事人提出简洁明确的问题，每个争议点最多追问一次。

### 3. 举证质证

**【智能流程加载】进入质证环节时，流程加载引擎.md 自动加载：**

- core/智能协议/{案件类型}/证据规则.md
- core/认知组件/证据引擎.md

**逐证质证流程（强制单个处理）**

1. **原告举证**：原告逐一提交证据并说明证明目的

2. **逐证质证机制**：

   - **⚠️ 重要**：必须**一个证据一个证据**进行质证，禁止一次性质证全部
   - 法官主持："现在请各被告对证据 X 进行质证"
   - 各被告**依次**就**单个证据**的真实性、合法性、关联性发表质证意见
   - 原告针对该证据的质证意见作出回应
   - 完成一个证据质证后，再进行下一个证据

3. **质证流程控制**：

   ```
   证据1 → 被告一质证 → 被告二质证 → 被告三质证 → 原告回应 → 下一证据
   证据2 → 被告一质证 → 被告二质证 → 被告三质证 → 原告回应 → 下一证据
   ...以此类推
   ```

4. **被告举证**：各被告依次举证，同样采用逐证质证机制
5. **法官小结**：基于证据引擎对证据进行评价和归类

### 4. 争议焦点归纳

**【智能流程加载】进入争议焦点环节时，流程加载引擎.md 自动：**

- 卸载质证环节组件（证据规则.md、证据引擎.md）
- 加载争议聚焦.md 组件

1. **法官宣读**：法官基于争议聚焦组件宣读识别出的争议焦点
2. **各方确认**：各方对争议焦点发表确认意见
3. **焦点确认**：法官确认最终争议焦点

### 5. 法庭辩论

**【智能流程加载】进入法庭辩论环节时，流程加载引擎.md 自动：**

- 卸载争议聚焦.md 组件
- 加载辩论规则.md、法律适用规则.md

**辩论流程**：

1. **焦点一**：
   - 原告 → 被告一 → 被告二 → 被告三 → 原告再次发言
2. **焦点二**：
   - 同样的发言顺序
3. **焦点三**：
   - 同样的发言顺序
4. **最终陈述**：
   - 各方作最后总结发言

### 6. 法庭调解（可选）

如果各方有调解意愿，进入调解程序。

### 7. 判决

**【智能流程加载】进入判决环节时，流程加载引擎.md 自动：**

- 卸载辩论环节组件（辩论规则.md、法律适用规则.md）
- 加载判决生成.md、评议规则.md

1. **法官总结**：法官基于加载的组件总结案件事实、争议焦点、举证质证情况
2. **智能判决**：基于判决生成.md 组件自动生成专业判决书
3. **后续程序**：生成判决书后触发相关后续程序

## 渐进式协议交互机制

与四大智能引擎的协调机制：

```yaml
渐进式四引擎协同:
  阶段1: 预处理引擎 → 快速启动，案件类型识别
  阶段2: 角色激活引擎 → 按需激活，文件夹加载
  阶段2.5: 注意力路由引擎 → 智能聚焦，认知优化
  阶段3: 流程加载引擎 → 环节驱动，专项加载

具体交互流程: 1. 开庭 → 预处理引擎 → 庭审引擎.md 准备协议路由
  2. 首次发言 → 角色激活引擎 → 加载角色文件夹内容
  3. 角色激活后 → 注意力路由引擎 → 配置专属注意力矩阵
  4. 质证开始 → 流程加载引擎 → 加载证据规则.md + 证据引擎.md
  5. 环节切换时 → 注意力路由引擎 → 动态调整注意力等级
  6. 争议焦点 → 流程加载引擎 → 切换到争议聚焦.md
  7. 法庭辩论 → 流程加载引擎 → 切换到辩论规则.md
  8. 判决阶段 → 流程加载引擎 → 切换到判决生成.md
```

## 渐进式系统集成

### 四引擎协同

- **预处理引擎.md**：提供 3-8 秒快速启动能力
- **角色激活引擎.md**：提供 2-3 秒首次角色激活，<1 秒后续切换
- **注意力路由引擎.md**：提供即时注意力配置，25-35%决策质量提升
- **流程加载引擎.md**：提供<2 秒环节切换，50-60%内存节省

### 智能协议集成

- 与庭审引擎.md 协同控制庭审节奏（渐进式路由）
- 与智能协议（民事/刑事/行政）保持按需同步（延迟加载）
- 与认知组件按环节实时交互（流程驱动）

### 性能提升总结

```yaml
优化效果:
  启动速度: "15-30秒 → 3-8秒 (60-75%提升)"
  角色切换: "每次5-8秒 → 首次3秒,后续<1秒"
  内存使用: "全量占用 → 按需占用 (50-60%节省)"
  用户体验: "信息过载 → 精准投递 (30%效率提升)"
  错误率: "全局干扰 → 聚焦当前 (40%错误率降低)"
```
